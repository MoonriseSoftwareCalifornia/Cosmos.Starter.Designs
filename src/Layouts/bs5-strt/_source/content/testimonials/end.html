<!-- Testimonials Page JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Testimonial filtering functionality
    const filterBtns = document.querySelectorAll('.filter-btn');
    const testimonialItems = document.querySelectorAll('.testimonial-item');
    const testimonialsGrid = document.getElementById('testimonials-grid');
    
    // Filter testimonials
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filterValue = this.getAttribute('data-filter');
            
            // Update active button
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Add loading state
            testimonialsGrid.classList.add('testimonials-loading');
            
            setTimeout(() => {
                // Filter items
                testimonialItems.forEach(item => {
                    if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                });
                
                // Remove loading state
                testimonialsGrid.classList.remove('testimonials-loading');
            }, 300);
        });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Animate hero statistics on scroll
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px 0px -100px 0px'
    };
    
    const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const statNumbers = entry.target.querySelectorAll('.stat-number');
                statNumbers.forEach(stat => {
                    animateNumber(stat);
                });
                statsObserver.unobserve(entry.target);
            }
        });
    }, observerOptions);
    
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) {
        statsObserver.observe(heroStats);
    }
    
    // Number animation function
    function animateNumber(element) {
        const finalText = element.textContent;
        const hasPercent = finalText.includes('%');
        const hasPlus = finalText.includes('+');
        const hasSlash = finalText.includes('/');
        
        // Extract numeric value
        let numericValue = parseFloat(finalText.replace(/[^\d.]/g, ''));
        
        if (isNaN(numericValue)) return;
        
        let current = 0;
        const increment = numericValue / 60; // Animation duration
        
        const timer = setInterval(() => {
            current += increment;
            if (current >= numericValue) {
                current = numericValue;
                clearInterval(timer);
            }
            
            let displayValue = hasSlash ? current.toFixed(1) : Math.floor(current);
            
            if (hasPercent) displayValue += '%';
            if (hasPlus) displayValue += '+';
            if (hasSlash) displayValue += '/5';
            
            element.textContent = displayValue;
        }, 16);
    }
    
    // Testimonial card hover effects
    const testimonialCards = document.querySelectorAll('.testimonial-card');
    testimonialCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-10px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Carousel auto-play control
    const carousel = document.getElementById('testimonialCarousel');
    if (carousel) {
        const carouselInstance = new bootstrap.Carousel(carousel, {
            interval: 8000, // 8 seconds
            wrap: true,
            keyboard: true
        });
        
        // Pause on hover
        carousel.addEventListener('mouseenter', () => {
            carouselInstance.pause();
        });
        
        carousel.addEventListener('mouseleave', () => {
            carouselInstance.cycle();
        });
    }
    
    // Lazy loading for images
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.style.opacity = '0';
                img.onload = () => {
                    img.style.transition = 'opacity 0.3s ease';
                    img.style.opacity = '1';
                };
                observer.unobserve(img);
            }
        });
    });
    
    const testimonialImages = document.querySelectorAll('.testimonial-avatar, .client-logo img');
    testimonialImages.forEach(img => imageObserver.observe(img));
    
    // Search functionality for testimonials
    function setupTestimonialSearch() {
        const searchInput = document.getElementById('testimonial-search');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                testimonialItems.forEach(item => {
                    const text = item.querySelector('.testimonial-text').textContent.toLowerCase();
                    const author = item.querySelector('h6').textContent.toLowerCase();
                    const company = item.querySelector('small').textContent.toLowerCase();
                    
                    const matchesSearch = text.includes(searchTerm) || 
                                        author.includes(searchTerm) || 
                                        company.includes(searchTerm);
                    
                    if (matchesSearch || searchTerm === '') {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                });
            });
        }
    }
    
    // Initialize search if element exists
    setupTestimonialSearch();
    
    // Keyboard navigation for filters
    filterBtns.forEach((btn, index) => {
        btn.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                e.preventDefault();
                const nextIndex = e.key === 'ArrowRight' ? 
                    (index + 1) % filterBtns.length : 
                    (index - 1 + filterBtns.length) % filterBtns.length;
                filterBtns[nextIndex].focus();
            }
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
    });
    
    // Add ARIA labels for accessibility
    filterBtns.forEach(btn => {
        btn.setAttribute('role', 'button');
        btn.setAttribute('aria-pressed', btn.classList.contains('active'));
    });
    
    // Update ARIA labels when filter changes
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            filterBtns.forEach(b => b.setAttribute('aria-pressed', 'false'));
            this.setAttribute('aria-pressed', 'true');
        });
    });
    
    // Testimonial card reading functionality
    testimonialCards.forEach(card => {
        card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                // Focus on the testimonial text for screen readers
                const testimonialText = this.querySelector('.testimonial-text');
                if (testimonialText) {
                    testimonialText.focus();
                }
            }
        });
        
        // Make cards focusable
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'article');
        card.setAttribute('aria-label', 'Customer testimonial');
    });
    
    // Performance optimization: Debounce scroll events
    let scrollTimer = null;
    window.addEventListener('scroll', function() {
        if (scrollTimer) {
            clearTimeout(scrollTimer);
        }
        scrollTimer = setTimeout(function() {
            // Add any scroll-based animations here
            const scrolled = window.pageYOffset;
            const parallax = document.querySelector('.hero-bg');
            if (parallax) {
                parallax.style.transform = `translateY(${scrolled * 0.5}px)`;
            }
        }, 10);
    });
    
    // Star rating hover effects
    const starRatings = document.querySelectorAll('.testimonial-stars');
    starRatings.forEach(rating => {
        const stars = rating.querySelectorAll('i');
        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', function() {
                stars.forEach((s, i) => {
                    if (i <= index) {
                        s.style.transform = 'scale(1.2)';
                        s.style.color = '#ffd700';
                    }
                });
            });
            
            star.addEventListener('mouseleave', function() {
                stars.forEach(s => {
                    s.style.transform = 'scale(1)';
                    s.style.color = '';
                });
            });
        });
    });
    
    // Copy testimonial functionality
    function copyTestimonial(card) {
        const text = card.querySelector('.testimonial-text').textContent;
        const author = card.querySelector('h6').textContent;
        const company = card.querySelector('small').textContent;
        
        const testimonialText = `"${text}" - ${author}, ${company}`;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(testimonialText).then(() => {
                showNotification('Testimonial copied to clipboard!');
            });
        }
    }
    
    // Add copy buttons to testimonials (optional)
    testimonialCards.forEach(card => {
        const copyBtn = document.createElement('button');
        copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        copyBtn.className = 'btn btn-sm btn-outline-primary copy-testimonial';
        copyBtn.style.position = 'absolute';
        copyBtn.style.top = '15px';
        copyBtn.style.right = '15px';
        copyBtn.style.opacity = '0';
        copyBtn.style.transition = 'opacity 0.3s ease';
        copyBtn.title = 'Copy testimonial';
        
        card.style.position = 'relative';
        card.appendChild(copyBtn);
        
        card.addEventListener('mouseenter', () => {
            copyBtn.style.opacity = '0.7';
        });
        
        card.addEventListener('mouseleave', () => {
            copyBtn.style.opacity = '0';
        });
        
        copyBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            copyTestimonial(card);
        });
    });
    
    // Simple notification system
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = '1';
        }, 100);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }
    
    console.log('Testimonials page initialized successfully');
});

// Utility function to add more testimonials dynamically
function addTestimonial(testimonial) {
    const testimonialsGrid = document.getElementById('testimonials-grid');
    const testimonialItem = document.createElement('div');
    testimonialItem.className = 'col-lg-4 col-md-6 testimonial-item';
    testimonialItem.setAttribute('data-category', testimonial.category);
    
    testimonialItem.innerHTML = `
        <div class="testimonial-card h-100">
            <div class="testimonial-content">
                <div class="testimonial-stars mb-3">
                    ${Array(testimonial.rating).fill('<i class="fas fa-star text-warning"></i>').join('')}
                </div>
                <p class="testimonial-text">${testimonial.text}</p>
            </div>
            <div class="testimonial-author">
                <img src="${testimonial.avatar}" alt="${testimonial.name}" class="testimonial-avatar rounded-circle">
                <div>
                    <h6 class="mb-0">${testimonial.name}</h6>
                    <small class="text-muted">${testimonial.title}, ${testimonial.company}</small>
                </div>
            </div>
        </div>
    `;
    
    testimonialsGrid.appendChild(testimonialItem);
}

// Analytics tracking for testimonial interactions
function trackTestimonialInteraction(action, testimonialId) {
    // Example analytics tracking
    if (typeof gtag !== 'undefined') {
        gtag('event', action, {
            event_category: 'Testimonials',
            event_label: testimonialId
        });
    }
}
</script>
